<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dental Safe Check - ì „ì‹ ì§ˆí™˜ ì •ë°€ ì²´í¬</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Noto Sans KR) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Number Input Arrows Removal */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- Icons (Lucide Style SVGs) ---
        const Icon = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke={color} 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Icons = {
            Stethoscope: (props) => <Icon {...props}><path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/><path d="M8 15v6"/><path d="M11 17a6 6 0 0 1-6-6"/></Icon>,
            Activity: (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></Icon>,
            AlertTriangle: (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></Icon>,
            CheckCircle: (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>,
            XCircle: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></Icon>,
            ShieldAlert: (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>,
            FileText: (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></Icon>,
            User: (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
            UserCheck: (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></Icon>,
            ChevronRight: (props) => <Icon {...props}><polyline points="9 18 15 12 9 6"/></Icon>,
            RefreshCcw: (props) => <Icon {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></Icon>,
            HeartPulse: (props) => <Icon {...props}><path d="M19 14c1.49-1.28 3.6-2.34 4.58-2.74a.45.45 0 0 0 .19-.57 2.37 2.37 0 0 0-2.2-1.74c-.9 0-1.74.45-2.2 1.17l-.37.56a.46.46 0 0 1-.77 0l-2.07-3.1a.48.48 0 0 0-.79-.01l-1.37 1.95a.48.48 0 0 1-.77.02l-1.31-1.8a.48.48 0 0 0-.78-.01L4.85 15.3a.48.48 0 0 1-.84-.14L2.8 11.7a.48.48 0 0 0-.85-.09l-1.72 2.45a.45.45 0 0 0 .09.6c1.02.8 3.1 2.1 4.58 2.74a4.34 4.34 0 0 0 3.73-.25L12 15l2.45 1.55a4.34 4.34 0 0 0 3.72.25c.5-.22 1.42-.58 2.23-1.07l.2-.13"/></Icon>,
            Pill: (props) => <Icon {...props}><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><line x1="8.5" y1="8.5" x2="15.5" y2="15.5"/></Icon>,
            Syringe: (props) => <Icon {...props}><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/></Icon>,
            Droplet: (props) => <Icon {...props}><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></Icon>,
            Biohazard: (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" stroke="none" /><path d="M8 12h8"/><path d="M12 8v8"/></Icon> 
        };

        // --- Data & Logic ---

        const QUESTIONS = [
            {
                id: 'hypertension',
                category: 'cardio',
                text: 'í˜„ì¬ ê³ í˜ˆì•• ì§„ë‹¨ì„ ë°›ì•˜ê±°ë‚˜ í˜ˆì••ì•½ì„ ë³µìš© ì¤‘ì´ì‹ ê°€ìš”?',
                detail: 'ì§„ë‹¨ ë°›ì€ ì ì´ ì—†ë”ë¼ë„ í˜ˆì••ì´ ë†’ë‹¤ê³  ëŠë¼ì‹œë©´ ì²´í¬í•´ì£¼ì„¸ìš”.',
                hasInputs: true
            },
            {
                id: 'diabetes',
                category: 'endocrine',
                text: 'ë‹¹ë‡¨ë³‘ì´ ìˆê±°ë‚˜ ì¸ìŠë¦°/ë‹¹ë‡¨ì•½ì„ ì‚¬ìš© ì¤‘ì´ì‹ ê°€ìš”?',
                detail: 'ë‹¹ë‡¨ê°€ ì˜ì‹¬ë˜ê±°ë‚˜ ìµœê·¼ í˜ˆë‹¹ ìˆ˜ì¹˜ í™•ì¸ì´ í•„ìš”í•˜ì‹œë©´ ì²´í¬í•´ì£¼ì„¸ìš”.',
                hasInputs: true
            },
            {
                id: 'anticoagulant',
                category: 'medication',
                text: 'í”¼ë¥¼ ë¬½ê²Œ í•˜ëŠ” ì•½(ì•„ìŠ¤í”¼ë¦°, ì™€íŒŒë¦° ë“±)ì„ ë“œì‹œë‚˜ìš”?',
                detail: 'ì‹¬í˜ˆê´€ ì§ˆí™˜, ë‡Œì¡¸ì¤‘ ì˜ˆë°© ëª©ì ìœ¼ë¡œ ë³µìš© ì¤‘ì…ë‹ˆë‹¤.'
            },
            {
                id: 'bleeding_tendency',
                category: 'medication',
                text: 'ìƒì²˜ê°€ ë‚¬ì„ ë•Œ í”¼ê°€ ì˜ ë©ì§€ ì•Šê±°ë‚˜, ë©ì´ ì‰½ê²Œ ë“œë‚˜ìš”?',
                detail: 'ê³¼ê±° ë°œì¹˜ë‚˜ ìˆ˜ìˆ  í›„ ì§€í˜ˆì´ ì–´ë ¤ì› ë˜ ê²½í—˜ì´ ìˆë‹¤ë©´ ì²´í¬í•´ì£¼ì„¸ìš”.'
            },
            {
                id: 'osteoporosis',
                category: 'medication',
                text: 'ê³¨ë‹¤ê³µì¦ ì•½ì„ ë“œì‹œê±°ë‚˜ ì£¼ì‚¬ë¥¼ ë§ìœ¼ì‹  ì ì´ ìˆë‚˜ìš”?',
                detail: 'ë¹„ìŠ¤í¬ìŠ¤í¬ë„¤ì´íŠ¸ ê³„ì—´ ì•½ë¬¼ ë³µìš© í˜¹ì€ ì£¼ì‚¬ ì¹˜ë£Œ ê²½í—˜.'
            },
            {
                id: 'infectious',
                category: 'other',
                text: 'Bí˜•/Cí˜• ê°„ì—¼, ê²°í•µ ë“± ì „ì—¼ì„± ì§ˆí™˜ì„ ì•“ê³  ê³„ì‹ ê°€ìš”?',
                detail: 'ì˜ë£Œì§„ì˜ ê°ì—¼ ì˜ˆë°©ê³¼ ì•ˆì „í•œ ê¸°êµ¬ ì‚¬ìš©ì„ ìœ„í•´ ê¼­ ì•Œë ¤ì£¼ì„¸ìš”.'
            },
            {
                id: 'endocarditis',
                category: 'cardio',
                text: 'ê³¼ê±°ì— ì‹¬ë‚´ë§‰ì—¼ì„ ì•“ì•˜ê±°ë‚˜ ì¸ê³µ ì‹¬ì¥ íŒë§‰ ìˆ˜ìˆ ì„ ë°›ìœ¼ì…¨ë‚˜ìš”?',
                detail: 'ì„ ì²œì„± ì‹¬ì¥ ì§ˆí™˜ í¬í•¨.'
            },
            {
                id: 'kidney_liver',
                category: 'organ',
                text: 'ì‹ ì¥(ì½©íŒ¥) íˆ¬ì„ ì¤‘ì´ê±°ë‚˜ ì‹¬ê°í•œ ê°„ ì§ˆí™˜ì´ ìˆìœ¼ì‹ ê°€ìš”?',
                detail: 'ê°„ê²½í™”, ë§ê¸° ì‹ ë¶€ì „ ë“±.'
            },
            {
                id: 'pregnancy',
                category: 'other',
                text: 'í˜„ì¬ ì„ì‹  ì¤‘ì´ê±°ë‚˜ ì„ì‹  ê°€ëŠ¥ì„±ì´ ìˆë‚˜ìš”?',
                detail: 'ìˆ˜ìœ  ì¤‘ì¸ ê²½ìš°ë„ í¬í•¨í•´ì£¼ì„¸ìš”.'
            }
        ];

        const analyzeCondition = (answers) => {
            let status = 'safe'; 
            let patientMessage = 'ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¹˜ë£Œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            let doctorNotes = [];
            let riskLevel = 0;

            // 1. Hypertension
            if (answers.hypertension) {
                riskLevel += 1;
                const sys = parseInt(answers.bp_sys);
                const dia = parseInt(answers.bp_dia);
                
                let bpNote = 'ì§„ë£Œ ì „ í˜ˆì•• ì¬í™•ì¸ í•„ìˆ˜.';
                let bpStatus = 'monitor'; 

                if (sys || dia) {
                    bpNote = `í™˜ì ìê°€ ì¸¡ì • í˜ˆì••: ${sys || '?'} / ${dia || '?'} mmHg. `;
                    if (sys >= 160 || dia >= 100) {
                        bpStatus = 'danger';
                        status = 'danger';
                        bpNote += 'Stage 2 ê³ í˜ˆì••. ì‘ê¸‰ ì¹˜ê³¼ ì²˜ì¹˜ ì™¸ ë‹¹ì¼ Elective treatment ì—°ê¸° ê°•ë ¥ ê¶Œê³ . ë‚´ê³¼ ì˜ë¢° ìš”ë§.';
                        patientMessage = 'í˜„ì¬ í˜ˆì••ì´ ìƒë‹¹íˆ ë†’ìŠµë‹ˆë‹¤. ì•ˆì „ì„ ìœ„í•´ ì˜¤ëŠ˜ ì¹˜ë£ŒëŠ” ë¯¸ë£¨ê±°ë‚˜ ì‘ê¸‰ ì²˜ì¹˜ë§Œ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                    } else if (sys >= 140 || dia >= 90) {
                        bpStatus = 'warning';
                        if (status !== 'danger') status = 'caution';
                        bpNote += 'Stage 1 ê³ í˜ˆì••. ì¹˜ë£Œ ì¤‘ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜. Stress reduction protocol.';
                    } else {
                        bpNote += 'Controlled. í†µìƒì  ì§„ë£Œ ê°€ëŠ¥.';
                    }
                } else {
                    bpNote += ' 160/100mmHg ì´ìƒ ì‹œ ì¹˜ë£Œ ì—°ê¸° ê³ ë ¤. Epinephrine 2 ample ì´í•˜ ì‚¬ìš©.';
                }

                doctorNotes.push({
                    type: bpStatus,
                    title: 'ê³ í˜ˆì•• (Hypertension)',
                    content: bpNote
                });
            }

            // 2. Diabetes
            if (answers.diabetes) {
                riskLevel += 1;
                const bsl = parseInt(answers.bs_level);
                const isHighSugar = answers.bs_high_symptom;
                const isLowSugar = answers.bs_low_symptom;

                let dmNote = 'ì €í˜ˆë‹¹ ì‡¼í¬ ì£¼ì˜. ì•„ì¹¨ ì‹ì‚¬ í™•ì¸.';
                let dmStatus = 'monitor';

                if (bsl || isHighSugar || isLowSugar) {
                    if (bsl) dmNote = `í™˜ì ìê°€ ì¸¡ì • í˜ˆë‹¹: ${bsl} mg/dL. `;
                    else dmNote = '';

                    if ((bsl >= 200) || isHighSugar) {
                        dmStatus = 'warning';
                        if (status !== 'danger') status = 'caution';
                        dmNote += 'ê³ í˜ˆë‹¹(>200). ê°ì—¼ ì·¨ì•½. ê´€í˜ˆì  ìˆ ì‹ í›„ í•­ìƒì œ/ì¹˜ìœ  ì§€ì—° ì„¤ëª….';
                    }
                    else if ((bsl > 0 && bsl < 70) || isLowSugar) {
                        dmStatus = 'danger';
                        status = 'danger';
                        dmNote += 'ì €í˜ˆë‹¹(<70) ìœ„í—˜. Glucose ê³µê¸‰ í›„ ì•ˆì • ì‹œê¹Œì§€ ì§„ë£Œ ë³´ë¥˜.';
                        patientMessage = 'ì €í˜ˆë‹¹ ì¦ìƒ/ìˆ˜ì¹˜ê°€ í™•ì¸ë©ë‹ˆë‹¤. ì‡¼í¬ ì˜ˆë°©ì„ ìœ„í•´ ë‹¹ë¶„ ì„­ì·¨ê°€ í•„ìš”í•˜ë©° ì¹˜ë£Œê°€ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                    } 
                    else if (bsl) {
                        dmNote += 'Controlled. í†µìƒ ì§„ë£Œ ê°€ëŠ¥.';
                    }
                }

                doctorNotes.push({
                    type: dmStatus,
                    title: 'ë‹¹ë‡¨ (Diabetes)',
                    content: dmNote
                });
            }

            // 3. Anticoagulants
            if (answers.anticoagulant) {
                status = status === 'danger' ? 'danger' : 'caution';
                patientMessage = 'ë“œì‹œëŠ” ì•½ìœ¼ë¡œ ì¸í•´ ì§€í˜ˆì´ ëŠ¦ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ë£Œì§„ê³¼ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'warning',
                    title: 'í•­í˜ˆì „ì œ/í•­ì‘ê³ ì œ ë³µìš©',
                    content: 'ë°œì¹˜/ì¹˜ì£¼ì¹˜ë£Œ ì‹œ ì¤‘ë‹¨ ë¶ˆí•„ìš”(ì¼ë°˜ì ). ì™€íŒŒë¦° INR í™•ì¸. ê´‘ë²”ìœ„ ìˆ˜ìˆ  ì‹œ í˜‘ì§„ ë° ì§€í˜ˆì œ(Surgicel ë“±) ì¤€ë¹„.'
                });
            }

            // 4. Bleeding Tendency (NEW)
            if (answers.bleeding_tendency) {
                status = 'danger';
                patientMessage = 'ì§€í˜ˆì´ ì˜ ë˜ì§€ ì•ŠëŠ” ì¦ìƒì€ ì¹˜ê³¼ ì¹˜ë£Œ ì‹œ ë§¤ìš° ìœ„í—˜í•  ìˆ˜ ìˆì–´ ì •ë°€ ê²€ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'critical',
                    title: 'ì¶œí˜ˆ ì†Œì¸ (Bleeding Diathesis)',
                    content: 'ê³¼ê±° ì§€í˜ˆ ì§€ì—° ë³‘ë ¥/ë©. í˜ˆì†ŒíŒ ê°ì†Œì¦, í˜ˆìš°ë³‘, ê°„ ì§ˆí™˜ ë“± ê°ë³„ í•„ìš”. 1ì°¨ ì˜ë£Œê¸°ê´€ ë‹¨ë… ì‹œìˆ  ìœ„í—˜. í˜ˆì•¡ê²€ì‚¬(CBC, PT/aPTT) ê²°ê³¼ í™•ì¸ ì „ê¹Œì§€ ì¹¨ìŠµì  ì¹˜ë£Œ ê¸ˆê¸°.'
                });
            }

            // 5. Osteoporosis
            if (answers.osteoporosis) {
                status = status === 'danger' ? 'danger' : 'caution';
                patientMessage = 'ê³¨ë‹¤ê³µì¦ ì•½ë¬¼ ë³µìš© ê¸°ê°„ì— ë”°ë¼ ë°œì¹˜ ë“± ì¹˜ë£Œì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'danger',
                    title: 'ê³¨ë‹¤ê³µì¦ ì•½ë¬¼ (MRONJ Risk)',
                    content: 'ì•½ë¬¼ ì œí˜•(ì£¼ì‚¬/ê²½êµ¬) ë° ê¸°ê°„ í™•ì¸. 3ë…„ ì´ìƒ ë³µìš© ì‹œ ê³ ìœ„í—˜êµ°. ë°œì¹˜ ì‹œ íœ´ì•½ê¸°(Drug Holiday) í˜‘ì§„.'
                });
            }

            // 6. Infectious Diseases (NEW)
            if (answers.infectious) {
                riskLevel += 1;
                // ê°ì—¼ì„± ì§ˆí™˜ ìì²´ëŠ” ë‹¹ì¥ ì¹˜ë£Œ ë¶ˆê°€ëŠ¥ì€ ì•„ë‹ˆë‚˜ ì£¼ì˜ í•„ìš”
                if (status === 'safe') status = 'caution'; 
                doctorNotes.push({
                    type: 'warning',
                    title: 'ê°ì—¼ì„± ì§ˆí™˜ (Infectious Diseases)',
                    content: 'Standard Precaution ì¤€ìˆ˜ í•„ìˆ˜. í™œë™ì„± ê²°í•µ(TB) ì˜ì‹¬ ì‹œ ì‘ê¸‰ ì™¸ ì§„ë£Œ ì—°ê¸° ë° ê²©ë¦¬. ê°„ì—¼(HBV, HCV) ë³´ê· ì ì‹œ ê°„ ê¸°ëŠ¥ ì €í•˜ ë° ì§€í˜ˆ ì§€ì—° ê°€ëŠ¥ì„± í™•ì¸.'
                });
            }

            // 7. Endocarditis
            if (answers.endocarditis) {
                status = 'danger';
                patientMessage = 'ì‹¬ì¥ ë³´í˜¸ë¥¼ ìœ„í•´ ì¹˜ë£Œ ì „ ì˜ˆë°©ì  í•­ìƒì œ ë³µìš©ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'critical',
                    title: 'ê°ì—¼ì„± ì‹¬ë‚´ë§‰ì—¼ ê³ ìœ„í—˜êµ°',
                    content: 'ì¶œí˜ˆ ë™ë°˜ ì‹œìˆ  ì „ ì˜ˆë°©ì  í•­ìƒì œ(Amoxicillin 2g) íˆ¬ì—¬ í•„ìˆ˜. ì•ŒëŸ¬ì§€ ì‹œ Clindamycin 600mg ëŒ€ì²´.'
                });
            }

            // 8. Kidney/Liver
            if (answers.kidney_liver) {
                status = 'danger';
                patientMessage = 'ì „ì‹  ìƒíƒœì— ë”°ë¼ ì•½ë¬¼ ì²˜ë°© ë° ì¹˜ë£Œ ê³„íš ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'warning',
                    title: 'ì‹ ì¥/ê°„ ê¸°ëŠ¥ ì €í•˜',
                    content: 'ì•½ë¬¼ ëŒ€ì‚¬ ê³ ë ¤ ìš©ëŸ‰ ì¡°ì ˆ. íˆ¬ì„ í™˜ìëŠ” íˆ¬ì„ ë‹¤ìŒ ë‚  ì§„ë£Œ(í—¤íŒŒë¦° ë°˜ê°ê¸°). ì§€í˜ˆ í™•ì¸.'
                });
            }

            // 9. Pregnancy
            if (answers.pregnancy) {
                status = 'caution';
                patientMessage = 'ì„ì‹  ì‹œê¸°ì— ë”°ë¼ ì¹˜ë£Œ ê°€ëŠ¥ ì—¬ë¶€ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.';
                doctorNotes.push({
                    type: 'monitor',
                    title: 'ì„ì‹ ë¶€ (Pregnancy)',
                    content: '2ê¸°(14~20ì£¼) ì•ˆì „. ë°©ì‚¬ì„  ë‚©ë³µ í•„ìˆ˜. NSAIDs/Tetracycline ê¸ˆê¸°.'
                });
            }

            // Comprehensive Check
            if (status === 'safe' && riskLevel > 0) status = 'caution';

            // Message Adjustment
            if (status === 'caution' && !patientMessage.includes('ì§€í˜ˆ') && !patientMessage.includes('ê³¨ë‹¤ê³µì¦')) {
                patientMessage = 'ì˜ë£Œì§„ ìƒë‹´ í›„ ì•ˆì „í•˜ê²Œ ì¹˜ë£Œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            } else if (status === 'danger' && !patientMessage.includes('ì €í˜ˆë‹¹') && !patientMessage.includes('í˜ˆì••') && !patientMessage.includes('ì§€í˜ˆ')) {
                patientMessage = 'ì•ˆì „ì„ ìœ„í•´ ë‚´ê³¼ ì „ë¬¸ì˜ ì†Œê²¬ì´ í•„ìš”í•˜ê±°ë‚˜, ì˜¤ëŠ˜ ì¹˜ë£Œê°€ ë¯¸ë£¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            }

            return { status, patientMessage, doctorNotes };
        };

        // --- Main Component ---

        function DentalScreeningApp() {
            const [step, setStep] = useState('intro');
            const [answers, setAnswers] = useState({});
            const [viewMode, setViewMode] = useState('patient');

            const handleAnswer = (id, value) => {
                setAnswers(prev => {
                    const next = { ...prev, [id]: value };
                    if (!value) {
                        if (id === 'hypertension') {
                            delete next.bp_sys;
                            delete next.bp_dia;
                        }
                        if (id === 'diabetes') {
                            delete next.bs_level;
                            delete next.bs_high_symptom;
                            delete next.bs_low_symptom;
                        }
                    }
                    return next;
                });
            };

            const handleValueChange = (key, value) => {
                setAnswers(prev => ({ ...prev, [key]: value }));
            };

            const handleNext = () => {
                setStep('result');
            };

            const resetApp = () => {
                setAnswers({});
                setStep('intro');
                setViewMode('patient');
            };

            const result = useMemo(() => analyzeCondition(answers), [answers]);
            const allAnswered = QUESTIONS.every(q => answers[q.id] !== undefined);

            return (
                <div className="min-h-screen bg-slate-50 flex justify-center">
                    <div className="w-full max-w-md bg-white min-h-screen shadow-xl overflow-hidden flex flex-col">
                        
                        {/* Header */}
                        <header className="bg-blue-600 text-white p-4 flex items-center justify-between shadow-md z-10">
                            <div className="flex items-center gap-2">
                                <Icons.Stethoscope className="h-6 w-6" />
                                <h1 className="text-lg font-bold">Dental Safe Check</h1>
                            </div>
                            {step === 'result' && (
                                <button onClick={resetApp} className="text-sm bg-blue-700 px-3 py-1 rounded-full flex items-center gap-1 hover:bg-blue-800 transition">
                                    <Icons.RefreshCcw size={14} /> ì²˜ìŒìœ¼ë¡œ
                                </button>
                            )}
                        </header>

                        {/* Main Content Area */}
                        <main className="flex-1 overflow-y-auto p-4">
                            
                            {/* STEP 1: Intro */}
                            {step === 'intro' && (
                                <div className="flex flex-col items-center justify-center h-full text-center space-y-6 animate-fadeIn">
                                    <div className="bg-blue-50 p-6 rounded-full">
                                        <Icons.ShieldAlert className="h-20 w-20 text-blue-600" />
                                    </div>
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">ì¹˜ê³¼ ì¹˜ë£Œ ì „<br/>ì•ˆì „ ì ê²€</h2>
                                        <p className="text-slate-500">
                                            ì•ˆì „í•œ ì§„ë£Œë¥¼ ìœ„í•´ í™˜ìë¶„ì˜<br/>ì „ì‹  ê±´ê°• ìƒíƒœë¥¼ ì²´í¬í•©ë‹ˆë‹¤.<br/>
                                            (ì•½ 1ë¶„ ì†Œìš”)
                                        </p>
                                    </div>
                                    <button 
                                        onClick={() => setStep('survey')}
                                        className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-700 transition transform active:scale-95"
                                    >
                                        ìê°€ì§„ë‹¨ ì‹œì‘í•˜ê¸°
                                    </button>
                                </div>
                            )}

                            {/* STEP 2: Survey */}
                            {step === 'survey' && (
                                <div className="space-y-6 pb-20 animate-fadeIn">
                                    <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded text-sm text-yellow-800 mb-4">
                                        ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ í•´ë‹¹ë˜ëŠ” í•­ëª©ì— ì†”ì§í•˜ê²Œ ì²´í¬í•´ì£¼ì„¸ìš”.
                                    </div>
                                    
                                    {QUESTIONS.map((q) => (
                                        <div key={q.id} className="bg-white border rounded-xl p-5 shadow-sm hover:shadow-md transition">
                                            <div className="flex items-start gap-3 mb-3">
                                                {q.category === 'cardio' && <Icons.HeartPulse className="text-red-500 mt-1 shrink-0" />}
                                                {q.category === 'medication' && !q.id.includes('bleeding') && <Icons.Pill className="text-green-500 mt-1 shrink-0" />}
                                                {q.id === 'bleeding_tendency' && <Icons.Droplet className="text-red-600 mt-1 shrink-0" />}
                                                {q.id === 'infectious' && <Icons.Biohazard className="text-orange-600 mt-1 shrink-0" />}
                                                {q.category === 'endocrine' && <Icons.Activity className="text-orange-500 mt-1 shrink-0" />}
                                                {(q.category === 'organ' || q.category === 'other') && q.id !== 'infectious' && <Icons.Syringe className="text-purple-500 mt-1 shrink-0" />}
                                                
                                                <div>
                                                    <h3 className="font-bold text-lg leading-tight">{q.text}</h3>
                                                    <p className="text-xs text-slate-400 mt-1">{q.detail}</p>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-3 mt-4">
                                                <button 
                                                    onClick={() => handleAnswer(q.id, true)}
                                                    className={`py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2
                                                        ${answers[q.id] === true 
                                                            ? 'bg-blue-600 text-white shadow-inner ring-2 ring-blue-600 ring-offset-2' 
                                                            : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                                >
                                                    <Icons.CheckCircle size={18} /> ë„¤
                                                </button>
                                                <button 
                                                    onClick={() => handleAnswer(q.id, false)}
                                                    className={`py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2
                                                        ${answers[q.id] === false 
                                                            ? 'bg-slate-600 text-white shadow-inner ring-2 ring-slate-600 ring-offset-2' 
                                                            : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                                >
                                                    <Icons.XCircle size={18} /> ì•„ë‹ˆìš”
                                                </button>
                                            </div>

                                            {/* Sub Input: Hypertension */}
                                            {q.id === 'hypertension' && answers[q.id] === true && (
                                                <div className="mt-4 pt-4 border-t border-dashed border-slate-200 animate-fadeIn">
                                                    <p className="text-sm font-bold text-blue-800 mb-2">ğŸ©¸ í˜„ì¬ í˜ˆì••ì„ ì•„ì‹œë‚˜ìš”?</p>
                                                    <p className="text-xs text-slate-500 mb-3">ë³‘ì› ë‚´ í˜ˆì••ê³„ë¡œ ì¸¡ì • í›„ ì…ë ¥í•´ì£¼ì‹œë©´ ì •í™•í•œ íŒë‹¨ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
                                                    <div className="flex items-center gap-2">
                                                        <div className="flex-1">
                                                            <label className="text-xs font-semibold text-slate-500 block mb-1">ìˆ˜ì¶•ê¸° (ìµœê³ )</label>
                                                            <input 
                                                                type="number" 
                                                                placeholder="120"
                                                                value={answers.bp_sys || ''}
                                                                onChange={(e) => handleValueChange('bp_sys', e.target.value)}
                                                                className="w-full p-2 border border-slate-300 rounded text-center text-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                            />
                                                        </div>
                                                        <span className="text-slate-300 text-2xl mt-4">/</span>
                                                        <div className="flex-1">
                                                            <label className="text-xs font-semibold text-slate-500 block mb-1">ì´ì™„ê¸° (ìµœì €)</label>
                                                            <input 
                                                                type="number" 
                                                                placeholder="80"
                                                                value={answers.bp_dia || ''}
                                                                onChange={(e) => handleValueChange('bp_dia', e.target.value)}
                                                                className="w-full p-2 border border-slate-300 rounded text-center text-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Sub Input: Diabetes */}
                                            {q.id === 'diabetes' && answers[q.id] === true && (
                                                <div className="mt-4 pt-4 border-t border-dashed border-slate-200 animate-fadeIn">
                                                    <p className="text-sm font-bold text-orange-800 mb-2">ğŸ¬ í˜„ì¬ í˜ˆë‹¹ ìƒíƒœ ì²´í¬</p>
                                                    <div className="mb-4">
                                                        <label className="text-xs font-semibold text-slate-500 block mb-1">í˜„ì¬ í˜ˆë‹¹ ìˆ˜ì¹˜ (ì¸¡ì • ê°€ëŠ¥ ì‹œ)</label>
                                                        <div className="relative">
                                                            <input 
                                                                type="number" 
                                                                placeholder="ì˜ˆ: 120"
                                                                value={answers.bs_level || ''}
                                                                onChange={(e) => handleValueChange('bs_level', e.target.value)}
                                                                className="w-full p-2 pl-4 pr-12 border border-slate-300 rounded text-lg focus:ring-2 focus:ring-orange-500 outline-none"
                                                            />
                                                            <span className="absolute right-4 top-3 text-slate-400 text-sm">mg/dL</span>
                                                        </div>
                                                    </div>
                                                    <p className="text-xs font-semibold text-slate-500 mb-2">ë˜ëŠ” í˜„ì¬ ì¦ìƒì´ ìˆìœ¼ì‹ ê°€ìš”?</p>
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <button 
                                                            onClick={() => handleValueChange('bs_high_symptom', !answers.bs_high_symptom)}
                                                            className={`p-2 rounded border text-sm transition
                                                                ${answers.bs_high_symptom ? 'bg-orange-100 border-orange-500 text-orange-700 font-bold' : 'bg-white border-slate-200 text-slate-600'}`}
                                                        >
                                                            ê³ í˜ˆë‹¹ ì¦ìƒ<br/><span className="text-xs font-normal opacity-75">(ì‹¬í•œ ê°ˆì¦, í”¼ë¡œ)</span>
                                                        </button>
                                                        <button 
                                                            onClick={() => handleValueChange('bs_low_symptom', !answers.bs_low_symptom)}
                                                            className={`p-2 rounded border text-sm transition
                                                                ${answers.bs_low_symptom ? 'bg-red-100 border-red-500 text-red-700 font-bold' : 'bg-white border-slate-200 text-slate-600'}`}
                                                        >
                                                            ì €í˜ˆë‹¹ ì¦ìƒ<br/><span className="text-xs font-normal opacity-75">(ì‹ì€ë•€, ë–¨ë¦¼)</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            )}

                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* STEP 3: Results */}
                            {step === 'result' && (
                                <div className="animate-fadeIn">
                                    {/* View Toggle */}
                                    <div className="flex bg-slate-200 p-1 rounded-lg mb-6">
                                        <button
                                            onClick={() => setViewMode('patient')}
                                            className={`flex-1 py-2 text-sm font-bold rounded-md flex items-center justify-center gap-2 transition ${viewMode === 'patient' ? 'bg-white text-blue-600 shadow' : 'text-slate-500'}`}
                                        >
                                            <Icons.User size={16} /> í™˜ììš© ê²°ê³¼
                                        </button>
                                        <button
                                            onClick={() => setViewMode('doctor')}
                                            className={`flex-1 py-2 text-sm font-bold rounded-md flex items-center justify-center gap-2 transition ${viewMode === 'doctor' ? 'bg-slate-800 text-white shadow' : 'text-slate-500'}`}
                                        >
                                            <Icons.UserCheck size={16} /> ì˜ë£Œì§„ìš© ìƒì„¸
                                        </button>
                                    </div>

                                    {/* Patient View */}
                                    {viewMode === 'patient' && (
                                        <div className="text-center space-y-6">
                                            <div className={`
                                                p-8 rounded-3xl flex flex-col items-center justify-center space-y-4 shadow-lg border-4
                                                ${result.status === 'safe' ? 'bg-green-50 border-green-100' : ''}
                                                ${result.status === 'caution' ? 'bg-yellow-50 border-yellow-100' : ''}
                                                ${result.status === 'danger' ? 'bg-red-50 border-red-100' : ''}
                                            `}>
                                                {result.status === 'safe' && <Icons.CheckCircle className="w-24 h-24 text-green-500" />}
                                                {result.status === 'caution' && <Icons.AlertTriangle className="w-24 h-24 text-yellow-500" />}
                                                {result.status === 'danger' && <Icons.ShieldAlert className="w-24 h-24 text-red-500" />}
                                                
                                                <h2 className="text-2xl font-bold">
                                                    {result.status === 'safe' ? 'ì§„ë£Œ ê°€ëŠ¥' : 
                                                    result.status === 'caution' ? 'ìƒë‹´ í•„ìš”' : 'ì£¼ì˜ ìš”ë§'}
                                                </h2>
                                                <p className="text-slate-600 font-medium whitespace-pre-line leading-relaxed">
                                                    {result.patientMessage}
                                                </p>
                                            </div>

                                            <div className="bg-white p-5 rounded-xl shadow-sm border text-left">
                                                <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                                                    <Icons.FileText size={18} /> ë‚´ê°€ ì²´í¬í•œ í•­ëª©
                                                </h3>
                                                <ul className="space-y-2">
                                                    {Object.keys(answers).filter(k => answers[k] === true).length === 0 ? (
                                                        <li className="text-slate-400 text-sm">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</li>
                                                    ) : (
                                                        QUESTIONS.filter(q => answers[q.id]).map(q => (
                                                            <li key={q.id} className="text-sm bg-slate-50 p-2 rounded text-slate-700 border border-slate-100">
                                                                <span className="font-bold text-blue-600">â€¢ {q.text.split('?')[0]}</span>
                                                                {q.id === 'hypertension' && (answers.bp_sys || answers.bp_dia) && (
                                                                    <span className="block text-xs text-slate-500 mt-1 ml-3">
                                                                        â”” ì…ë ¥ í˜ˆì••: {answers.bp_sys || '?'} / {answers.bp_dia || '?'} mmHg
                                                                    </span>
                                                                )}
                                                                {q.id === 'diabetes' && (answers.bs_level || answers.bs_high_symptom || answers.bs_low_symptom) && (
                                                                    <span className="block text-xs text-slate-500 mt-1 ml-3">
                                                                        â”” {answers.bs_level ? `í˜ˆë‹¹: ${answers.bs_level}mg/dL` : ''} 
                                                                        {answers.bs_high_symptom ? ' [ê³ í˜ˆë‹¹ ì¦ìƒ]' : ''} 
                                                                        {answers.bs_low_symptom ? ' [ì €í˜ˆë‹¹ ì¦ìƒ]' : ''}
                                                                    </span>
                                                                )}
                                                            </li>
                                                        ))
                                                    )}
                                                </ul>
                                            </div>
                                            <p className="text-xs text-slate-400 mt-8">
                                                * ì´ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ì •í™•í•œ ì§„ë‹¨ì€ ì¹˜ê³¼ ì˜ì‚¬ ì„ ìƒë‹˜ê³¼ ìƒë‹´í•˜ì„¸ìš”.
                                            </p>
                                        </div>
                                    )}

                                    {/* Doctor View */}
                                    {viewMode === 'doctor' && (
                                        <div className="space-y-4">
                                            <div className="bg-slate-800 text-white p-4 rounded-xl shadow-lg">
                                                <h3 className="font-bold text-lg flex items-center gap-2 mb-2">
                                                    <Icons.Stethoscope size={20} /> Clinical Summary
                                                </h3>
                                                <div className="flex items-center gap-3 text-sm">
                                                    <span className={`px-2 py-1 rounded font-bold uppercase ${
                                                        result.status === 'safe' ? 'bg-green-500' : 
                                                        result.status === 'caution' ? 'bg-yellow-500 text-black' : 'bg-red-500'
                                                    }`}>
                                                        {result.status}
                                                    </span>
                                                    <span>
                                                        Risk Factors: {result.doctorNotes.length}
                                                    </span>
                                                </div>
                                            </div>

                                            {result.doctorNotes.length === 0 ? (
                                                <div className="text-center py-10 bg-white rounded-xl border border-dashed border-slate-300">
                                                    <Icons.CheckCircle className="w-12 h-12 text-green-400 mx-auto mb-3" />
                                                    <p className="text-slate-500 font-medium">No Specific Contraindications</p>
                                                    <p className="text-xs text-slate-400">ì¼ë°˜ì ì¸ í”„ë¡œí† ì½œì— ë”°ë¼ ì§„ë£Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                                                </div>
                                            ) : (
                                                result.doctorNotes.map((note, index) => (
                                                    <div key={index} className={`
                                                        border-l-4 rounded-r-xl p-4 shadow-sm bg-white
                                                        ${note.type === 'monitor' ? 'border-blue-500' : ''}
                                                        ${note.type === 'warning' ? 'border-yellow-500' : ''}
                                                        ${note.type === 'danger' ? 'border-orange-500' : ''}
                                                        ${note.type === 'critical' ? 'border-red-600 bg-red-50' : ''}
                                                    `}>
                                                        <h4 className={`font-bold text-sm mb-1 flex items-center gap-2
                                                            ${note.type === 'critical' ? 'text-red-700' : 'text-slate-800'}
                                                        `}>
                                                            {note.type === 'critical' && <Icons.AlertTriangle size={16} />}
                                                            {note.title}
                                                        </h4>
                                                        <p className="text-sm text-slate-600 leading-relaxed">
                                                            {note.content}
                                                        </p>
                                                    </div>
                                                ))
                                            )}
                                            
                                            <div className="mt-6 p-4 bg-slate-100 rounded-lg text-xs text-slate-500">
                                                <h5 className="font-bold mb-1">Disclaimer</h5>
                                                ë³¸ ê²°ê³¼ëŠ” ìŠ¤í¬ë¦¬ë‹ ë³´ì¡° ë„êµ¬ì…ë‹ˆë‹¤. ìµœì¢…ì ì¸ ì¹˜ë£Œ ê²°ì •ê³¼ íˆ¬ì•½ì— ëŒ€í•œ ì±…ì„ì€ ë‹´ë‹¹ ì¹˜ê³¼ì˜ì‚¬ì—ê²Œ ìˆìŠµë‹ˆë‹¤. ì „ì‹ ì§ˆí™˜ì´ ë³µí•©ì ì¸ ê²½ìš° ë°˜ë“œì‹œ ì£¼ì¹˜ì˜(ë‚´ê³¼ ë“±)ì™€ Consultë¥¼ ì§„í–‰í•˜ì‹­ì‹œì˜¤.
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                        </main>

                        {/* Footer / Floating Button */}
                        {step === 'survey' && (
                            <div className="p-4 bg-white border-t">
                                <button 
                                    onClick={handleNext}
                                    disabled={!allAnswered} 
                                    className={`w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg transition
                                        ${allAnswered 
                                            ? 'bg-blue-600 text-white hover:bg-blue-700 transform active:scale-95' 
                                            : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}
                                >
                                    ê²°ê³¼ í™•ì¸í•˜ê¸° <Icons.ChevronRight />
                                </button>
                                {!allAnswered && (
                                    <p className="text-xs text-center text-slate-400 mt-2">ëª¨ë“  í•­ëª©ì— ë‹µë³€í•´ì£¼ì„¸ìš”.</p>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DentalScreeningApp />);
    </script>
</body>
</html>
